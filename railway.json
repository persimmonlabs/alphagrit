{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  },
  "services": {
    "backend": {
      "source": {
        "repo": "backend"
      },
      "build": {
        "buildCommand": "pip install -r requirements.txt && alembic upgrade head"
      },
      "deploy": {
        "startCommand": "uvicorn src.main:app --host 0.0.0.0 --port $PORT",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 30
      },
      "variables": {
        "ENVIRONMENT": "production",
        "DATABASE_URL": "${{Postgres.DATABASE_URL}}",
        "JWT_SECRET_KEY": "${{shared.JWT_SECRET_KEY}}",
        "JWT_ALGORITHM": "HS256",
        "JWT_ACCESS_TOKEN_EXPIRE_MINUTES": "30",
        "JWT_REFRESH_TOKEN_EXPIRE_DAYS": "7",
        "STRIPE_SECRET_KEY": "${{shared.STRIPE_SECRET_KEY}}",
        "STRIPE_WEBHOOK_SECRET": "${{shared.STRIPE_WEBHOOK_SECRET}}",
        "MERCADO_PAGO_ACCESS_TOKEN": "${{shared.MERCADO_PAGO_ACCESS_TOKEN}}",
        "MERCADO_PAGO_WEBHOOK_SECRET": "${{shared.MERCADO_PAGO_WEBHOOK_SECRET}}",
        "R2_ACCOUNT_ID": "${{shared.R2_ACCOUNT_ID}}",
        "R2_ACCESS_KEY_ID": "${{shared.R2_ACCESS_KEY_ID}}",
        "R2_SECRET_ACCESS_KEY": "${{shared.R2_SECRET_ACCESS_KEY}}",
        "R2_BUCKET_NAME": "${{shared.R2_BUCKET_NAME}}",
        "R2_PUBLIC_URL": "${{shared.R2_PUBLIC_URL}}",
        "CORS_ORIGINS": "${{shared.CORS_ORIGINS}}"
      }
    },
    "frontend": {
      "source": {
        "repo": "."
      },
      "build": {
        "buildCommand": "npm install && npm run build"
      },
      "deploy": {
        "startCommand": "npm run start -- --port $PORT"
      },
      "variables": {
        "NEXT_PUBLIC_API_BASE_URL": "https://${{backend.RAILWAY_PUBLIC_DOMAIN}}/api/v1"
      }
    }
  }
}
